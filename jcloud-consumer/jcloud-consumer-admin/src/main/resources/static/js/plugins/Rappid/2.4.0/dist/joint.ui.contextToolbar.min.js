/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


joint.ui.ContextToolbar=joint.mvc.View.extend({className:"context-toolbar",eventNamespace:"context-toolbar",events:{"click .tool":"onToolPointerdown"},options:{padding:20,autoClose:!0,vertical:!1},documentEvents:{mousedown:"onDocumentPointerdown",touchstart:"onDocumentPointerdown"},init:function(){joint.util.bindAll(this,"onDocumentPointerdown")},render:function(){var a=this.options,b=this.constructor;return b.opened&&b.close(),a.autoClose&&this.delegateAutoCloseEvents(),a.type&&this.$el.attr("data-type",a.type),this.$el.toggleClass("joint-vertical",!!a.vertical),this.getRoot().append(this.$el),this.renderContent(),this.position(),b.opened=this,this},delegateAutoCloseEvents:function(){this.delegateDocumentEvents(),document.addEventListener("mousedown",this.onDocumentPointerdown,!0),document.addEventListener("touchstart",this.onDocumentPointerdown,!0)},undelegateAutoCloseEvents:function(){this.undelegateDocumentEvents(),document.removeEventListener("mousedown",this.onDocumentPointerdown,!0),document.removeEventListener("touchstart",this.onDocumentPointerdown,!0)},renderContent:function(){var a=$("<div/>",{"class":"tools"});this.options.tools&&joint.util.toArray(this.options.tools).forEach(function(b){var c;c=b.icon?$("<img/>",{src:b.icon}):b.content;var d=$("<button/>",{"class":"tool",html:c,"data-action":b.action});b.attrs&&d.attr(b.attrs),a.append(d)}),this.$el.append(a)},getRoot:function(){return $(this.options.root||document.documentElement)},position:function(){var a=joint.util.getElementBBox(this.options.target),b=joint.util.getElementBBox(this.getRoot()),c=this.$el.outerWidth(),d=a.x+a.width/2-c/2,e=a.y+a.height+this.options.padding;d-=b.x,e-=b.y,this.$el.css({left:d,top:e})},onRemove:function(){this.undelegateAutoCloseEvents(),this.constructor.opened=void 0},onToolPointerdown:function(a){var b=$(a.currentTarget).attr("data-action");b&&this.trigger("action:"+b,a)},onDocumentPointerdown:function(a){var b=this.options.target,c=a.target;this.el.contains(c)||b.contains(c)||b===c||(this.constructor.close(),this.remove())}},{opened:void 0,close:function(){this.opened&&(this.opened.remove(),this.opened=void 0)},update:function(){this.opened&&this.opened.position()}});