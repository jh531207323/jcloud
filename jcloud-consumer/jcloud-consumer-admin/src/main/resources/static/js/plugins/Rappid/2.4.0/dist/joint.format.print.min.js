/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b,c){var d=200,e=200;c.dia.Paper.prototype.print=function(a){var b=l(a),c=h.call(this,b),d=function(b){f.call(this,b,a)},e={sheetSizePx:j(b)};b.ready(c,d.bind(this),e)},c.dia.Paper.prototype.preparePrintArea=function(d,e){this.trigger("beforeprint",e);var f=a("<div/>").addClass("printarea"),g=a("<div/>").css("position","relative").appendTo(f);e.size&&f.addClass("printarea-size-"+e.size);var h=this.scale();this.scale(1),this.$el.children().clone().appendTo(g);var i=j(e),l=this.getArea(),m=k(l,d,i),n=m.bBox,o=m.scaleToFit;g.css({left:0,top:0}),b(g.find("svg")[0]).attr({width:n.width*o,height:n.height*o,style:"position:relative",viewBox:[n.x,n.y,n.width,n.height].join(" ")});var p=this.options.gridSize;if(p>1){var q=a("."+c.util.addClassNamePrefix("paper-grid"),f);q.remove()}var r=a("."+c.util.addClassNamePrefix("paper-background"),f);return r.remove(),this.scale(h.sx,h.sy),f.addClass("preview"),{$el:f,sheetSizePx:i}};var f=function(b,c){if(b){var d=a(document.body);d.addClass("joint-print");var e=this.$el.children().detach();b.forEach(function(a){a.removeClass("preview").addClass("print-ready").appendTo(d)});var f=!1,g=function(){f||(f=!0,d.removeClass("joint-print"),b.forEach(function(a){a.remove()}),this.$el.append(e),a("#print-styles").remove(),this.trigger("afterprint",c),a(window).off("afterprint",g))}.bind(this);a(window).one("afterprint",g),setTimeout(g,200),window.print()}},h=function(a){var b,c=o.call(this,a),d=[];if(a.poster)for(var e=q(c,a.poster),f=p(c,e),g=0;g<f.length;g++)b=this.preparePrintArea(f[g],a),d.push(b.$el);else b=this.preparePrintArea(c,a),d.push(b.$el);if(b){var h={width:b.sheetSizePx.cssWidth,height:b.sheetSizePx.cssHeight};n(h,a)}return d},i=function(a){return Object.keys(a).map(function(b){return b+":"+a[b]}).join(";")+";"},j=function(a){var b=c.util.normalizeSides(a.margin),d=a.sheet;b.unit=a.marginUnit,d.unit=a.sheetUnit;var e="calc("+d.width+d.unit+" - "+(b.left+b.right)+b.unit+")",f="calc("+d.height+d.unit+" - "+(b.top+b.bottom)+b.unit+")",g=r.measure(e,f,"");return{cssWidth:e,cssHeight:f,width:g.width,height:g.height}},k=function(a,b,c){var d,e=g.Rect({x:b.x-a.x,y:b.y-a.y,width:b.width,height:b.height}),f=e.width/e.height,h=c.width/c.height;return d=f>h?c.width/e.width:c.height/e.height,{bBox:e,scaleToFit:d,fitHorizontal:f>h}},l=function(a){var b=c.util.defaultsDeep({},a,{area:null,poster:!1,sheet:{width:210,height:297},sheetUnit:"mm",ready:function(a,b,c){b(a)},margin:.4,marginUnit:"in",padding:5});return b.area||(b.printingAll=!0),b},m=function(b){var c=a("#print-styles"),d='<style type="text/css" id="print-styles">'+b+"</style>";c.length?c.html(b):a("head").append(d)},n=function(a,b){var d=i(a),e=c.util.normalizeSides(b.margin),f=b.marginUnit,g=[e.top+f,e.right+f,e.bottom+f,e.left+f].join(" "),h="size:"+(b.sheet.width+b.sheet.unit)+" "+(b.sheet.height+b.sheet.unit),j=["@media print {",".printarea.print-ready {",d,"}","@page {","margin:"+g+";",h,"}",".printarea.preview {",d,"}","}"];m(j.join(""))},o=function(a){var b=a.area;if(!b){var d=c.util.normalizeSides(a.padding);b=this.getContentArea().moveAndExpand({x:-d.left,y:-d.top,width:d.left+d.right,height:d.top+d.bottom})}return b},p=function(a,b){for(var c,f=b.width,h=b.height,i=[],j=0,k=0,l=0,m=0;j<a.height;){for(;k<a.width&&(c=g.Rect(a.x+k,a.y+j,f,h),i.push(c),k+=f,!(m>e));)m++;if(k=0,m=0,j+=h,l>d)break;l++}return i},q=function(a,b){var c={width:b.width,height:b.height};return c.width||(c.width=Math.ceil(a.width/(b.columns||1))),c.height||(c.height=Math.ceil(a.height/(b.rows||1))),c},r={supportedUnits:{px:function(a){return a},mm:function(a){return this.millimeterSize*a},cm:function(a){return this.millimeterSize*a*10},"in":function(a){return this.millimeterSize*a*25.4},pt:function(a){return this.millimeterSize*(25.4*a/72)},pc:function(a){return this.millimeterSize*(25.4*a/6)}},measure:function(b,c,d){d=d||"";var e=a("<div/>").css({display:"inline-block",position:"absolute",left:-15e3,top:-15e3,width:b+d,height:c+d}).appendTo(document.body),f={width:e.width(),height:e.height()};return e.remove(),f},toPx:function(a,b){if(this.millimeterSize||(this.millimeterSize=this.measure(1,1,"mm").width),b=(b||"").toLowerCase(),!this.supportedUnits[b])throw new Error("Unsupportted unit "+b);return this.supportedUnits[b].call(this,a)}}}($,V,joint);