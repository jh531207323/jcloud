/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a){a.ui.Toolbar=a.mvc.View.extend({options:{},align:["left","right"],className:"toolbar",defaultGroup:"default",widgets:[],groupViews:[],init:function(){this.tools=a.util.toArray(this.options.tools),this.groups=this.options.groups||{}},getWidgetByName:function(a){return this.widgets.find(function(b){return b.options.name===a})},getWidgets:function(){return this.widgets},groupsWithItemsPairs:function(){var b={};this.tools.forEach(function(a){var c=a.group||this.defaultGroup;b[c]=b[c]||{items:[],group:{}},b[c].items.push(a),b[c].group=this.groups[c]||{}},this);for(var c=Object.keys(b),d=[],e=0,f=c.length;e<f;e++){var g=c[e];d.push([g,b[g]])}var h=a.util.sortBy(d,function(a){return a[1].group.index});return a.util.sortBy(h,function(a){return a[1].group.align||"left"})},render:function(){var a=this.groupsWithItemsPairs(),b=!1;return a.forEach(function(a){var c=a[0],d=a[1],e=this.renderGroup(c,d);!b&&d.group.align&&"right"===d.group.align&&(b=!0,e.addClass("group-first")),e.appendTo(this.el)},this),this},renderGroup:function(a,c){var d=new b({name:a,align:c.group.align,items:c.items,references:this.options.references});return this.groupViews.push(d),d.on("all",function(){this.trigger.apply(this,arguments)}.bind(this)),d.render(),this.widgets=this.widgets.concat(d.widgets),d.$el},onRemove:function(){a.util.invoke(this.groupViews,"off"),a.util.invoke(this.groupViews,"remove")}});var b=a.mvc.View.extend({className:"toolbar-group",init:function(){this.widgets=[]},onRender:function(){this.$el.attr("data-group",this.options.name),this.$el.addClass(this.options.align),this.renderItems()},renderItems:function(){a.util.toArray(this.options.items).forEach(function(a){var b=this.createWidget(a);this.$el.append(b.$el)},this)},createWidget:function(b){var c=a.ui.Widget.create(b,this.options.references);return c.on("all",function(a){var c=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[b.name+":"+a].concat(c))}.bind(this)),this.widgets.push(c),c},onRemove:function(){a.util.invoke(this.widgets,"off"),a.util.invoke(this.widgets,"remove")}})}(joint),function(a,b){a.ui.Widget=a.mvc.View.extend({className:"widget",references:[],constructor:function(b,c){this.availableReferences=c||{},a.mvc.View.prototype.constructor.call(this,b)},updateAttrs:function(b){a.util.setAttributesBySelector(this.$el,b)},bindEvents:function(){},validateReferences:function(){var a=this.references||[],b=[];return a.forEach(function(a){void 0===this.availableReferences[a]&&b.push(a)},this),b},getReference:function(a){return this.availableReferences[a]},getReferences:function(){return this.availableReferences}},{create:function(b,c){var d=a.util.camelCase(a.util.isString(b)?b:b.type);if(!a.util.isFunction(a.ui.widgets[d]))throw new Error('Widget: unable to find widget: "'+d+'"');var e=new a.ui.widgets[d](b,c),f=e.validateReferences(c);if(f.length>0)throw new Error('Widget: "'+d+'" missing dependency: '+f.join(", "));return e.render(),e.updateAttrs(b.attrs),e.bindEvents(),e.$el.attr("data-type",d),b.name&&e.$el.attr("data-name",b.name),e}}),a.ui.widgets={checkbox:a.ui.Widget.extend({tagName:"label",events:{"change .input":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick"},documentEvents:{mouseup:"pointerup",touchend:"pointerup"},init:function(){a.util.bindAll(this,"pointerup")},render:function(){var a=this.options,c=b("<span/>").text(a.label||"");return this.$input=b("<input/>",{type:"checkbox","class":"input"}).prop("checked",!!a.value),this.$span=b("<span/>"),this.$el.append([c,this.$input,this.$span]),this},onChange:function(a){this.trigger("change",!!a.target.checked,a)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-in-action"),this.trigger("pointerdown",b),this.delegateDocumentEvents()},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerup:function(b){b=a.util.normalizeEvent(b),this.undelegateDocumentEvents(),this.trigger("pointerup",b),this.$el.removeClass("is-in-action"),"touchend"===b.type&&(this.$input.trigger("click"),b.preventDefault())}}),toggle:a.ui.Widget.extend({tagName:"label",events:{"change input.toggle":"onChange","click input.toggle":"pointerclick",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},documentEvents:{mouseup:"pointerup",touchend:"pointerup"},init:function(){a.util.bindAll(this,"pointerup")},render:function(){var a=this.options,c=b("<span/>").text(a.label||""),d=b("<span><i/></span>");this.$input=b("<input/>",{type:"checkbox","class":"toggle"}).prop("checked",!!a.value);var e=b("<div/>").addClass(a.type);return this.$el.append([c,e.append(this.$input,d)]),this},onChange:function(a){this.trigger("change",!!a.target.checked,a)},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-in-action"),this.trigger("pointerdown",b),this.delegateDocumentEvents()},pointerup:function(b){b=a.util.normalizeEvent(b),this.undelegateDocumentEvents(),this.$el.removeClass("is-in-action"),this.trigger("pointerup",b),"touchend"===b.type&&(this.$input.trigger("click"),b.preventDefault())}}),separator:a.ui.Widget.extend({render:function(){return this.options.width&&this.$el.css({width:this.options.width}),this}}),label:a.ui.Widget.extend({tagName:"label",render:function(){return this.$el.text(this.options.text),this}}),range:a.ui.Widget.extend({events:{"change .input":"onChange","input .input":"onChange"},render:function(){var a,c=this.options;return this.$output=b("<output/>").text(c.value),a=b("<span/>").addClass("units").text(c.unit),this.$input=b("<input/>",{type:"range",name:c.type,min:c.min,max:c.max,step:c.step,"class":"input"}).val(c.value),this.$el.append([this.$input,this.$output,a]),this},onChange:function(a){var b=parseInt(this.$input.val(),10);b!==this.currentValue&&(this.currentValue=b,this.$output.text(b),this.trigger("change",b,a))},setValue:function(a){this.$input.val(a),this.$input.trigger("change")}}),selectBox:a.ui.Widget.extend({render:function(){var b=a.util.omit(this.options,"type","group","index");return this.selectBox=new a.ui.SelectBox(b),this.selectBox.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectBox.on("all",this.trigger,this)}}),button:a.ui.Widget.extend({events:{mousedown:"pointerdown",mouseup:"pointerup",touchend:"pointerup",touchstart:"pointerdown",click:"pointerclick"},tagName:"button",render:function(){var a=this.options;return this.$el.text(a.text),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b)},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b),"touchend"===b.type&&(this.$el.trigger("click"),b.preventDefault())}}),inputText:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=b("<label/>").text(a.label),this.$text=b("<input/>",{type:"text","class":"input"}).val(a.value),this.$input=b("<div/>").addClass("input-wrapper").append(this.$text),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b),"touchstart"===b.type&&this.$text.trigger("focus")},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b),"touchend"===b.type&&(this.$text.trigger("click"),b.preventDefault())},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),inputNumber:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=b("<label/>").text(a.label),this.$number=b("<input/>",{type:"number","class":"number",max:a.max,min:a.min}).val(a.value),this.$input=b("<div/>").addClass("input-wrapper").append(this.$number),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b),"touchstart"===b.type&&this.$number.trigger("focus")},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b),"touchend"===b.type&&(this.$number.trigger("click"),b.preventDefault())},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),textarea:a.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var a=this.options;return this.$label=b("<label/>").text(a.label),this.$textarea=b("<textarea/>",{"class":"textarea"}).text(a.value),this.$input=b("<div/>").addClass("input-wrapper").append(this.$textarea),this.$el.append([this.$label,this.$input]),this},pointerclick:function(b){b.preventDefault(),b=a.util.normalizeEvent(b),this.trigger("pointerclick",b)},pointerdown:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerdown",b),"touchstart"===b.type&&this.$textarea.focus()},pointerup:function(b){b=a.util.normalizeEvent(b),this.trigger("pointerup",b),"touchend"===b.type&&(this.$textarea.trigger("click"),b.preventDefault())},pointerfocusin:function(b){b=a.util.normalizeEvent(b),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",b)},pointerfocusout:function(b){b=a.util.normalizeEvent(b),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",b)}}),selectButtonGroup:a.ui.Widget.extend({render:function(){var b=a.util.omit(this.options,"type","group","index");return this.selectButtonGroup=new a.ui.SelectButtonGroup(b),this.selectButtonGroup.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectButtonGroup.on("all",this.trigger,this)}})},a.ui.widgets.zoomIn=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoom(c.step,{max:c.max,grid:c.step}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomOut=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoom(-c.step,{min:c.min,grid:c.step}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomToFit=a.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(b){var c=this.options;this.getReferences().paperScroller.zoomToFit({padding:20,scaleGrid:c.step,minScale:c.min,maxScale:c.max}),a.ui.widgets.button.prototype.pointerdown.call(this,b)}}),a.ui.widgets.zoomSlider=a.ui.widgets.range.extend({references:["paperScroller"],options:{min:20,max:500,step:20,value:100,unit:" %"},bindEvents:function(){this.on("change",function(a){this.getReferences().paperScroller.zoom(a/100,{absolute:!0,grid:this.options.step/100})},this),this.getReferences().paperScroller.options.paper.on("scale",function(a){this.setValue(Math.floor(100*a))},this)}}),a.ui.widgets.undo=a.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.undo()}}),a.ui.widgets.redo=a.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.redo()}}),a.ui.widgets.fullscreen=a.ui.widgets.button.extend({onRender:function(){var a=this.target=b(this.options.target)[0];a&&!b.contains(window.top.document,a)&&this.$el.hide()},pointerclick:function(){a.util.toggleFullScreen(this.target)}})}(joint,$);