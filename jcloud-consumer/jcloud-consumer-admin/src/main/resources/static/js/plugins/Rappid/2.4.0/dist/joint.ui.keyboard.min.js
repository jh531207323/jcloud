/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b){"use strict";var c=function(){a.util.bindAll(this,"handleKey"),this.parser=new d,this.enable()};a.util.assign(c.prototype,b.Events),c.prototype.on=function(a,c,d){return b.Events.on.call(this,this.normalizeEvent(a),c,d),this},c.prototype.off=function(a,c,d){var e=a?this.normalizeEvent(a):null;return b.Events.off.call(this,e,c,d),this},c.prototype.normalizeEvent=function(a){if("object"==typeof a){for(var b=Object.keys(a),c={},d=0,e=b.length;d<e;d++){var f=b[d];c[this.normalizeEvent(f)]=a[f]}return c}return this.normalizeShortcut(a)},c.prototype.normalizeShortcut=function(a){if("all"===a.toLowerCase())return a;for(var b=this.parser.toEventObjectList(a),c=[],d=0;d<b.length;d++)c.push(this.hash(b[d]));return c.join(" ")},c.prototype.enable=function(){window.addEventListener?(document.addEventListener("keydown",this.handleKey,!1),document.addEventListener("keypress",this.handleKey,!1),document.addEventListener("keyup",this.handleKey,!1)):window.attachEvent&&(document.attachEvent("keydown",this.handleKey,!1),document.attachEvent("keypress",this.handleKey,!1),document.attachEvent("keyup",this.handleKey,!1))},c.prototype.disable=function(){window.removeEventListener?(document.removeEventListener("keydown",this.handleKey,!1),document.removeEventListener("keypress",this.handleKey,!1),document.removeEventListener("keyup",this.handleKey,!1)):window.detachEvent&&(document.detachEvent("keydown",this.handleKey,!1),document.detachEvent("keypress",this.handleKey,!1),document.detachEvent("keyup",this.handleKey,!1))},c.prototype.isActive=function(a,b){return this.isModifierActive(a,b)},c.prototype.isModifierActive=function(a,b){for(var c=this.parser.toEventObjectList(a),d=0;d<c.length;d++)if(c[d].modifiersCompare(b))return!0;return!1},c.prototype.hash=function(a){var b=function(a){return a?1:0},c=[a.type,":",a.which,b(a.shiftKey),b(a.ctrlKey),b(a.altKey),b(a.metaKey)];return c.join("")},c.prototype.handleKey=function(a){if(!this.isUnsupportedElement(a)){var c=k.fromNative(a);b.Events.trigger.call(this,this.hash(c),a)}},c.prototype.isUnsupportedElement=function(a){var b=a.target||a.srcElement;if(b){var c=b.tagName.toUpperCase();return"INPUT"===c||"SELECT"===c||"TEXTAREA"===c||b.isContentEditable}return!1};var d=function(){};d.prototype={constructor:d,parseEventString:function(a){a=a||"";var b,c,e=a.split("+"),f=new k(0);for(c=0;c<e.length;c++){b=e[c];var g=this.getModifierPropertyName(b);g&&(f[g]=!0),1!==e.length&&void 0!==g||(f.which=d.getCode(b))}return f},toEventObjectList:function(a){var b=a.replace(/\s*\+\s*/gi,"+").split(" ");return b.map(this.composeEventObject,this)},composeEventObject:function(a){var b=a.split(":"),c=i.KEYDOWN,d=b[0];if(b.length>1&&(d=b[1],c=b[0]),j.indexOf(c)===-1)throw a+": invalid shortcut definition";var e=this.parseEventString(d);return c===i.KEYUP&&f[e.which]&&(e[f[e.which]]=!1),e.setType(c)},getModifierPropertyName:function(a){var b=e[a];return f[b]}},d.getCode=function(a){return h[a]||a.toUpperCase().charCodeAt(0)};var e={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91,meta:91},f={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},g={226:"\\",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},h={backspace:8,tab:9,shift:16,ctrl:17,alt:18,meta:91,clear:12,enter:13,"return":13,esc:27,escape:27,capslock:20,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,insert:45,ins:45,pageup:33,pagedown:34,plus:187,minus:189,"-":189,",":188,".":190,"/":191,"`":192,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},i={KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup"},j=[i.KEYPRESS,i.KEYDOWN,i.KEYUP],k=function(a,b,c,d,e,f){this.which=a,this.shiftKey=b||!1,this.ctrlKey=c||!1,this.altKey=d||!1,this.metaKey=e||!1,this.type=f||i.KEYDOWN};k.fromNative=function(a){var b=a.which;a.type===i.KEYPRESS&&(b=String.fromCharCode(a.which).toUpperCase().charCodeAt(0)),g[b]&&(b=d.getCode(g[b]));var c=new k(b,a.shiftKey,a.ctrlKey,a.altKey,a.metaKey,a.type);return a.type===i.KEYUP&&f[b]&&(c[f[b]]=!1),c},k.prototype.modifiersCompare=function(a){return!(this.shiftKey&&this.shiftKey!==a.shiftKey||this.ctrlKey&&this.ctrlKey!==a.ctrlKey||this.altKey&&this.altKey!==a.altKey||this.metaKey&&this.metaKey!==a.metaKey)},k.prototype.setType=function(a){return this.type=a,this},a.ui.Keyboard=c}(joint,Backbone);