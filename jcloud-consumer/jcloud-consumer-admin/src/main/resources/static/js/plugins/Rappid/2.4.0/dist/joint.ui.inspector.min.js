/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b){"use strict";a.ui.Inspector=a.mvc.View.extend({className:"inspector",options:{cellView:void 0,cell:void 0,live:!0,validateInput:function(a,b,c,d){return!a.validity||a.validity.valid},renderFieldContent:void 0,renderLabel:void 0,operators:{},multiOpenGroups:!0,stateKey:function(a){return a.id}},events:{"change [data-attribute]:not([data-custom-field])":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem","mousedown .field":"pointerdown","touchstart .field":"pointerdown","focusin .field":"pointerfocusin","focusout .field":"pointerfocusout"},HTMLEntities:{lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',cent:"¢",pound:"£",euro:"€",yen:"¥",copy:"©",reg:"®"},init:function(){var c=this.options.groups=this.options.groups||{};a.util.bindAll(this,"stopBatchCommand","pointerup","onContentEditableBlur","replaceHTMLEntity"),this.widgets={},this._attributeKeysInUse=[],this.flatAttributes=this.flattenInputs(this.options.inputs),this.expandAttributes=this.expandAttrs(this.options.inputs||{}),this._when={},this._bound={};var d=Object.keys(this.flatAttributes).map(function(a){var b=this.flatAttributes[a];if(b.when){var c={expression:b.when,path:a};this.extractExpressionPaths(c.expression).forEach(function(a){(this._when[a]||(this._when[a]=[])).push(c)},this)}return this.needsResolving(b)&&(this._bound[a]=b.options),b.path=a,b},this);for(var e in c){var f=c[e];f&&c.hasOwnProperty(e)&&this.extractExpressionPaths(f.when).forEach(function(a){this._when[a]||(this._when[a]=[])},this)}var g=b.sortBy(d,"index");this.groupedFlatAttributes=b.sortBy(g,function(a){var b=this.options.groups[a.group];return b&&b.index||Number.MAX_VALUE}.bind(this)),this.listenTo(this.getModel(),"all",this.onCellChange,this)},cacheInputs:function(){var a={};Array.from(this.$("[data-attribute]")).forEach(function(b){var c=$(b),d=c.attr("data-attribute");a[d]=c},this),this._byPath=a,this._attributeKeysInUse=this.getAttributeKeysInUse()},updateGroupsVisibility:function(){for(var a=this.$groups,b=0,c=a.length;b<c;b++){var d=$(a[b]),e=d.attr("data-name"),f=this.options.groups[e],g=0===d.find("> .field:not(.hidden)").length;d.toggleClass("empty",g);var h=!(!f||!f.when||this.isExpressionValid(f.when));d.toggleClass("hidden",h)}},expandAttrs:function(a){for(var c={},d=Object.keys(a),e=0;e<d.length;e++){var f=d[e],g=a[f],h=f.split("/");b.setByPath(c,h,b.isPlainObject(g)?this.expandAttrs(g):g)}return c},flattenInputs:function(b){return a.util.flattenObject(b,"/",function(a){return"string"==typeof a.type})},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(a,b,c,d){if(d=d||{},d.inspector!=this.cid)switch(a){case"remove":this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:var e="change:";if(a.slice(0,e.length)===e){var f=a.slice(e.length);this._attributeKeysInUse.includes(f)&&this.render({refresh:!0})}}},render:function(a){var b=a&&a.refresh;b&&this.options.storeGroupsState&&this.storeGroupsState(),this.$el.empty(),this.removeWidgets();var c,d,e=[];return this.groupedFlatAttributes.forEach(function(a){if(c!==a.group){var f=this.options.groups[a.group];d=this.renderGroup({name:a.group,label:f&&f.label}),b||(f&&f.closed?this.closeGroup(d,{init:!0}):this.openGroup(d,{init:!0})),e.push(d)}this.renderTemplate(d,a,a.path),c=a.group},this),this.$document=$(this.el.ownerDocument),this.$groups=$(e),this.$el.append(e),b&&this.options.restoreGroupsState&&this.restoreGroupsState(),this.afterRender(),this},getAttributeKeysInUse:function(){var a=Object.keys(this._byPath).map(function(a){return a.substring(0,a.indexOf("/"))||a}),c=b.toArray(this._bound),d=Object.keys(this._when);return b.uniq([].concat(a,c,d))},getCellAttributeValue:function(b,c){var d=this.getModel(),e=a.util.getByPath(d.attributes,b,"/");if(c=c||this.flatAttributes[b],!c)return e;if(void 0===e&&void 0!==c.defaultValue&&(e=c.defaultValue),c.valueRegExp){if(void 0===e)throw new Error("Inspector: defaultValue must be present when valueRegExp is used.");var f=e.match(new RegExp(c.valueRegExp));e=f&&f[2]}return e},resolvableTypes:["select","select-box","color-palette","select-button-group"],needsResolving:function(b){return!!b&&this.resolvableTypes.indexOf(b.type)>-1&&a.util.isString(b.options)},resolveBindings:function(c){if(this.resolvableTypes.indexOf(c.type)>-1){var d=c.options||[];a.util.isString(d)&&(d=a.util.getByPath(this.getModel().attributes,d,"/")||[]),a.util.isObject(d[0])||(d=b.toArray(d).map(function(a){return{value:a,content:a}})),c.items=d}},updateBindings:function(b){var c=Object.keys(this._bound).reduce(function(a,c){var d=this._bound[c];return 0===b.indexOf(d)&&a.push(c),a}.bind(this),[]);a.util.isEmpty(c)||(c.forEach(function(a){this.renderTemplate(null,this.flatAttributes[a],a,{replace:!0})},this),this.afterRender())},renderFieldContent:function(c,d,e){var f;if(a.util.isFunction(this.options.renderFieldContent)&&(f=this.options.renderFieldContent(c,d,e,this)))return $(f).attr({"data-attribute":d,"data-type":c.type,"data-custom-field":!0});var g,h,i,j;switch(c.type){case"select-box":h=a.util.toArray(c.items).findIndex(function(b){var d=b.value,f=e;if(void 0===d&&b.content===f)return!0;var g=c.key;return g&&(f=a.util.getByPath(f,g,"/"),d=a.util.getByPath(d,g,"/")),a.util.isEqual(d,f)});var k=a.util.assign({theme:this.options.theme},a.util.omit(c,"type","group","index","selectBoxOptionsClass","options"),{options:c.items,selected:h,selectBoxOptionsClass:[a.util.addClassNamePrefix("inspector-select-box-options"),c.selectBoxOptionsClass].filter(function(a){return!!a}).join(" ")});g=new a.ui.SelectBox(k),g.$el.attr({"data-attribute":d,"data-type":c.type,"data-overwrite":c.overwrite}),g.render(),j=this.renderOwnLabel(c,d),f=$("<div/>").append(j,g.el),c.previewMode?(i=g.selection,g.on("options:mouseout close",function(){g.selection=i,this.processInput(g.$el,{previewCancel:!0,dry:!0})},this),g.on("option:hover",function(a,b){g.selection=a,this.processInput(g.$el,{dry:!0})},this),g.on("option:select",function(a,b){var c=void 0===i?void 0:g.getSelectionValue(i),d=g.getSelectionValue(a),e=c===d;this.processInput(g.$el,{previewDone:!0,dry:e,originalValue:c}),i=a},this)):g.on("option:select",function(a,b){this.processInput(g.$el)},this),this.widgets[d]=g;break;case"color-palette":h=a.util.toArray(c.items).findIndex(function(a){return a.value===e||void 0===a.value&&a.content===e});var l=a.util.assign({theme:this.options.theme},a.util.omit(c,"type","group","index","options"),{options:c.items,selected:h});g=new a.ui.ColorPalette(l),g.$el.attr({"data-attribute":d,"data-type":c.type}),g.render(),j=this.renderOwnLabel(c,d),f=$("<div/>").append(j,g.el),c.previewMode?(i=g.selection,g.on("options:mouseout close",function(){g.selection=i,this.processInput(g.$el,{previewCancel:!0,dry:!0})},this),g.on("option:hover",function(a,b){g.selection=a,this.processInput(g.$el,{dry:!0})},this),g.on("option:select",function(a,b){var c=void 0===i?void 0:g.getSelectionValue(i),d=g.getSelectionValue(a),e=c===d;this.processInput(g.$el,{previewDone:!0,dry:e,originalValue:c}),i=a},this)):g.on("option:select",function(a,b){this.processInput(g.$el)},this),this.widgets[d]=g;break;case"select-button-group":c.multi?(h=[],a.util.toArray(c.items).forEach(function(b,d){var f=void 0===b.value?b.content:b.value,g=c.key;g&&(f=a.util.getByPath(f,g,"/"));var i=a.util.toArray(e).find(function(b){return g&&(b=a.util.getByPath(b,g,"/")),a.util.isEqual(f,b)});i&&h.push(d)})):h=a.util.toArray(c.items).findIndex(function(b){var d=b.value,f=e;if(void 0===d&&b.content===f)return!0;var g=c.key;return g&&(f=a.util.getByPath(f,g,"/"),d=a.util.getByPath(d,g,"/")),a.util.isEqual(d,f)});var m=a.util.assign({theme:this.options.theme},a.util.omit(c,"type","group","index","options"),{options:c.items,selected:h});g=new a.ui.SelectButtonGroup(m),g.$el.attr({"data-attribute":d,"data-type":c.type,"data-overwrite":c.overwrite}),g.render(),j=this.renderOwnLabel(c,d),f=$("<div/>").append(j,g.el),c.previewMode?(i=g.selection,g.on("mouseout",function(){g.selection=i,this.processInput(g.$el,{previewCancel:!0,dry:!0})},this),g.on("option:hover",function(a,d){c.multi?g.selection=b.uniq(g.selection.concat([a])):g.selection=a,this.processInput(g.$el,{dry:!0})},this),g.on("option:select",function(b,c){var d=void 0===i?void 0:g.getSelectionValue(i),e=g.getSelectionValue(b),f=a.util.isEqual(d,e);this.processInput(g.$el,{previewDone:!0,dry:f,originalValue:d}),i=b},this)):g.on("option:select",function(a,b){this.processInput(g.$el)},this),this.widgets[d]=g;break;default:f=this.renderOwnFieldContent({options:c,type:c.type,overwrite:c.overwrite,label:c.label||d,attribute:d,value:e})}return f},renderGroup:function(a){a=a||{};var b=$("<div/>").addClass("group").attr("data-name",a.name),c=$("<h3/>").addClass("group-label").text(a.label||a.name);return b.append(c)},renderOwnLabel:function(a,b){var c,d=this.options.renderLabel;if("function"==typeof d&&(c=d(a,b,this)),void 0!==c)return $(c);switch(a.type){case"select-box":case"color-palette":case"select-button-group":return $("<label/>").html(a.label||b);default:return $("<label/>").text(a.label||b)}},renderOwnFieldContent:function(b){var c,d,e,f,g,h,i,j;switch(j=this.renderOwnLabel(b.options,b.attribute),b.type){case"number":d=$("<input/>",{type:"number",min:b.options.min,max:b.options.max,step:b.options.step}).val(b.value),c=[j,$("<div/>").addClass("input-wrapper").append(d)];break;case"range":j.addClass("with-output"),f=$("<output/>").text(b.value),g=$("<span/>").addClass("units").text(b.options.unit),d=$("<input/>",{type:"range",name:b.type,min:b.options.min,max:b.options.max,step:b.options.step}).val(b.value),d.on("change input",function(){f.text(d.val())}),c=[j,f,g,d];break;case"textarea":d=$("<textarea/>").text(b.value),c=[j,$("<div/>").addClass("input-wrapper").append(d)];break;case"content-editable":var k=a.util.isString(b.value)?b.value.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"):"";d=$("<div/>").prop("contenteditable",!0).css("display","inline-block").html(k).on("blur",this.onContentEditableBlur),c=[j,$("<div/>").addClass("input-wrapper").append(d)];break;case"select":var l=b.options.items;d=$("<select/>"),b.options.multiple&&d.prop({size:b.options.size||l.length,multiple:!0});var m=function(c){return b.options.multiple?a.util.toArray(b.value).find(function(b){return a.util.isEqual(c,b)}):a.util.isEqual(c,b.value)};a.util.toArray(l).forEach(function(a){var b=$("<option/>",{value:a.value}).text(a.content);m(a.value)&&b.attr("selected","selected"),d.append(b)}),c=[j,d];break;case"toggle":h=$("<span><i/></span>"),d=$("<input/>",{type:"checkbox"}).prop("checked",!!b.value),e=$("<div/>").addClass(b.type),c=[j,e.append(d,h)];break;case"color":d=$("<input/>",{type:"color"}).val(b.value),c=[j,d];break;case"text":d=$("<input/>",{type:"text"}).val(b.value),c=[j,$("<div/>").addClass("input-wrapper").append(d)];break;case"object":d=$("<div/>"),i=$("<div/>").addClass("object-properties"),c=[j,d.append(i)];break;case"list":h=$("<button/>").addClass("btn-list-add").text(b.options.addButtonLabel||"+"),i=$("<div/>").addClass("list-items"),d=$("<div/>"),c=[j,d.append(h,i)]}return d&&d.addClass(b.type).attr({"data-type":b.type,"data-attribute":b.attribute,"data-overwrite":b.overwrite}),$.fn.append.apply($("<div>"),c).children()},onContentEditableBlur:function(a){var b=$("<input/>",{disabled:!0,tabIndex:-1,style:{width:"1px",height:"1px",border:"none",margin:0,padding:0}}).appendTo(this.$el);b.focus(),b[0].setSelectionRange(0,0),b.blur().remove(),$(a.target).trigger("change")},replaceHTMLEntity:function(a,b){return this.HTMLEntities[b]||""},renderObjectProperty:function(a){a=a||{};var b=$("<div/>",{"data-property":a.property,"class":"object-property"});return b},renderListItem:function(a){a=a||{};var b=$("<button/>").addClass("btn-list-del").text(a.options.removeButtonLabel||"-"),c=$("<div/>",{"data-index":a.index,"class":"list-item"});return c.append(b)},renderFieldContainer:function(a){a=a||{};var b=$("<div/>",{"data-field":a.path,"class":"field "+a.type+"-field"});return b},renderTemplate:function(c,d,e,f){c=c||this.$el,f=f||{},this.resolveBindings(d);var g=this.renderFieldContainer({path:e,type:d.type});d.when&&!this.isExpressionValid(d.when)&&(g.addClass("hidden"),d.when.otherwise&&d.when.otherwise.unset&&this.unsetProperty(e));var h=this.getCellAttributeValue(e,d),i=this.renderFieldContent(d,e,h);if(g.append(i),a.util.setAttributesBySelector(g,d.attrs),"list"===d.type){a.util.toArray(h).forEach(function(a,b){var c=this.renderListItem({index:b,options:d});this.renderTemplate(c,d.item,e+"/"+b),i.children(".list-items").append(c)},this);var j=h&&h.length,k=d&&d.min,l=d&&d.max;this.fixListButtons(i,j,k,l)}else if("object"===d.type){var m=this.flattenInputs(d.properties),n=Object.keys(m).map(function(a){var b=this[a];return b.path=a,b},m);n=b.sortBy(n,function(a){return a.index}),n.forEach(function(a){var b=this.renderObjectProperty({property:a.path});this.renderTemplate(b,a,e+"/"+a.path),i.children(".object-properties").append(b)},this)}f.replace?c.find('[data-field="'+e+'"]').replaceWith(g):c.append(g)},updateInputPosition:function(){var a=this._byPath["position/x"],b=this._byPath["position/y"],c=this.getModel().get("position");a&&a.val(c.x),b&&b.val(c.y)},updateInputSize:function(){var a=this._byPath["size/width"],b=this._byPath["size/height"],c=this.getModel().get("size");a&&a.val(c.width),b&&b.val(c.height)},updateInputAngle:function(){var a=this._byPath.angle,b=this.getModel().get("angle");a&&a.val(b)},validateInput:function(a,b,c){switch(a){case"select-box":case"color-palette":var d=this.widgets[c];return!!d&&d.getSelectionIndex()!==-1;case"select-button-group":return!!this.widgets[c];default:return this.options.validateInput(b,c,a,this)}},onChangeInput:function(a){a.target===a.currentTarget&&this.processInput($(a.target))},processInput:function(a,b){var c=a.attr("data-attribute"),d=a.attr("data-type");if(this.validateInput(d,a[0],c)){this.options.live&&this.updateCell(a,c,b);var e=this.getFieldValue(a[0],d),f=this.parse(d,e,a[0]);this.trigger("change:"+c,f,a[0],b)}},updateDependants:function(b){a.util.toArray(this._when[b]).forEach(function(a){var b=this._byPath[a.path],c=b.closest(".field"),d=c.hasClass("hidden"),e=this.isExpressionValid(a.expression);c.toggleClass("hidden",!e),a.expression.otherwise&&a.expression.otherwise.unset&&this.options.live&&(e?d&&this.updateCell(b,a.path):(this.unsetProperty(a.path),this.renderTemplate(null,this.flatAttributes[a.path],a.path,{replace:!0}),this.afterRender()))},this)},unsetProperty:function(b,c){var d=this.getModel(),e=b.split("/"),f=e[0],g=e.slice(1).join("/");if(c=c||{},c.inspector=this.cid,c["inspector_"+this.cid]=!0,"attrs"==b)d.removeAttr(g,c);else if(b==f)d.unset(f,c);else{var h=a.util.merge({},d.get(f)),i=a.util.unsetByPath(h,g,"/");d.set(f,i,c)}},getOptions:function(a){if(0!==a.length){var b=a.attr("data-attribute");return this.getOptionsFromPath(b)}},markForRemoval:function(a,b){var c=this.findParentListByPath(a);if(c){var d=a.substr(c.length+1),e=parseInt(d,10);Number.isFinite(e)&&(b.remove[c]=b.remove[c]||[],b.remove[c].includes(e)||b.remove[c].push(e))}},markForUpdate:function(b,c,d,e){var f=b.substr(e.length+1);c.update[e]&&a.util.setByPath(c.update[e].value,f,d,"/")},updateCell:function(c,d,e){var f=this.getModel(),g={};c?g[d]=c:g=this._byPath,this.startBatchCommand();var h={},i={update:{},remove:{}};a.util.forIn(g,function(b,c){if(!b.closest(".field").hasClass("hidden")){var d=b.attr("data-type"),e=b.attr("data-overwrite"),g="false"!==e&&void 0!==e,j=b.hasClass("remove");switch(d){case"list":j&&this.markForRemoval(c,i);break;case"object":j&&this.markForRemoval(c,i);break;default:if(!this.validateInput(d,b[0],c))return;var k=this.getFieldValue(b[0],d),l=this.parse(d,k,b[0]),m=this.getOptionsFromPath(c);if(m.valueRegExp){var n=a.util.getByPath(f.attributes,c,"/")||m.defaultValue;l=n.replace(new RegExp(m.valueRegExp),"$1"+l+"$3")}if(j)this.markForRemoval(c,i);else{var o=m.parent;if(o&&"object"===o.type&&void 0!==o.overwrite&&o.overwrite!==!1){var p={},q=c.split("/"),r=q[q.length-1];p[r]=l,i.update[o.path]={value:p,overwrite:!0}}else h[c]={value:l,overwrite:g}}}}}.bind(this)),a.util.forIn(h,function(b,c){this.setProperty(c,b.value,a.util.assign({overwrite:b.overwrite},e)),this.updateBindings(c),this.updateDependants(c)}.bind(this));var j=b.sortBy(Object.keys(i.remove),function(a){return a.split("/").length}).reverse();j.forEach(function(b){var c=i.remove[b];this.removeProperty(b,c,a.util.assign({rewrite:!0},e))}.bind(this)),a.util.forIn(i.update,function(b,c){this.setProperty(c,this.compactDeep(b.value),a.util.assign({rewrite:!0,overwrite:b.overwrite},e)),this.updateBindings(c),this.updateDependants(c)}.bind(this)),this.updateGroupsVisibility(),this.stopBatchCommand()},compactDeep:function(a){return Array.isArray(a)?a.reduce(function(a,b){return b&&a.push(this.compactDeep(b)),a}.bind(this),[]):a},findParentListByPath:function(a){var b=a.split("/");b.pop();for(var c=b;c.length;){var d=this.getOptionsFromPath(c.join("/"));if(d&&"list"===d.type)return b.slice(0,c.length).join("/");c.pop()}return null},getOptionsFromPath:function(a){for(var c,d=a.split("/"),e=this.expandAttributes,f=[];d.length;){var g,h=g;e&&"object"===e.type?g="properties":(g=d.shift(),(d.length||"list"===e.type)&&(c=e,f.push(g)));var i=!Number.isNaN(parseInt(g));if(g=i&&"list"===e.type?"item":g,Object(e)!==e||!(g in e||e[a]))return{};e=e[g]||e[a]}return e=b.assign({},e),c=b.assign({},c),c.path=f.join("/"),h&&"properties"===h&&(c.type="object"),e.parent=c,e},getFieldValue:function(b,c){if(a.util.isFunction(this.options.getFieldValue)){var d=this.options.getFieldValue(b,c,this);if(d)return d.value}var e=$(b);switch(c){case"select-box":case"color-palette":case"select-button-group":var f=e.attr("data-attribute");return this.widgets[f].getSelectionValue();case"content-editable":return e.html().replace(/<br(\s*)\/*>/gi,"\n").replace(/<[p|div]\s/gi,"\n$0").replace(/(<([^>]+)>)/gi,"").replace(/&(\w+);/gi,this.replaceHTMLEntity).replace(/\n$/,"");default:return e.val()}},removeProperty:function(b,c,d){var e=this.getModel(),f=a.dia.Cell.prototype.prop,g=f.call(e,b);if(g){var h=g.reduce(function(a,b,d){return c.includes(d)||a.push(b),a},[]),i=this.flatAttributes[b];Array.isArray(h)&&0===h.length&&!i&&(h=null),f.call(e,b,h,d)}},setProperty:function(b,c,d){d=d||{},d.inspector=this.cid;var e=a.dia.Cell.prototype.prop,f=this.getModel(),g=d.overwrite||!1;if(d.previewDone&&e.call(f,b,d.originalValue,{rewrite:!0,silent:!0}),void 0===c)a.dia.Cell.prototype.removeProp.call(f,b,d);else{var h;if(a.util.isObject(c)&&!g){var i=e.call(f,b),j=Array.isArray(c)?[]:{};h=a.util.merge(j,i,c)}else h=a.util.clone(c);g&&(d.rewrite=!0),e.call(f,b,h,d)}},parse:function(a,b,c){switch(a){case"number":case"range":b=parseFloat(b);break;case"toggle":b=c.checked}return b},startBatchCommand:function(){if(!this.inBatch){this.inBatch=!0;var b=this.getModel();b instanceof a.dia.Cell&&b.startBatch("inspector",{cid:this.cid})}},stopBatchCommand:function(){if(this.inBatch){var b=this.getModel();b instanceof a.dia.Cell&&b.stopBatch("inspector",{cid:this.cid}),this.inBatch=!1}},afterRender:function(){this.cacheInputs(),this.updateGroupsVisibility(),this.trigger("render")},addListItem:function(a){var b=$(a.target),c=b.parent("[data-attribute]"),d=this.getOptions(c),e=c.children(".list-items"),f=e.children(".list-item"),g=f.last(),h=0===g.length?-1:parseInt(g.attr("data-index"),10),i=h+1,j=this.renderListItem({index:i,options:d}),k=c.attr("data-attribute")+"/"+i;this.renderTemplate(j,d.item,k),e.append(j),j.find("input:first").focus(),f=e.children(".list-item");var l=f.not(".remove"),m=l.length;this.fixListButtons(c,m,d.min,d.max),this.afterRender(),this.options.live&&this.updateCell()},deleteListItem:function(a){var b=$(a.target),c=b.closest("[data-attribute]"),d=this.getOptions(c),e=b.closest(".list-item");e.hide(),e.addClass("remove"),e.find("[data-field]").each(function(){$(this).hide().addClass("remove")}),e.find("[data-attribute]").each(function(){$(this).hide().addClass("remove")});var f=c.children(".list-items"),g=f.children(".list-item"),h=g.not(".remove"),i=h.length;this.fixListButtons(c,i,d.min,d.max),this.afterRender(),this.options.live&&this.updateCell()},fixListButtons:function(a,b,c,d){var e=function(a,b){return"number"!=typeof b||("number"!=typeof a||a<b)},f=function(a,b){return"number"!=typeof b||b<=0||!("number"!=typeof a||a<=0)&&a>b},g=a.children(".btn-list-add"),h=e(b,d);h?g.removeClass("hidden"):g.addClass("hidden");var i=a.children(".list-items").children(".list-item").children(".btn-list-del"),j=f(b,c);j?i.removeClass("hidden"):i.addClass("hidden")},bindDocumentEvents:function(){var a=this.getEventNamespace();this.$document.on("mouseup"+a+" touchend"+a,this.pointerup)},unbindDocumentEvents:function(){this.$document.off(this.getEventNamespace())},pointerdown:function(a){this.bindDocumentEvents(),this.startBatchCommand(),this._$activeField=$(a.currentTarget).addClass("is-in-action")},pointerup:function(){this.unbindDocumentEvents(),this.stopBatchCommand(),this._$activeField&&(this._$activeField.removeClass("is-in-action"),this._$activeField=null)},pointerfocusin:function(a){a.stopPropagation(),$(a.currentTarget).addClass("is-focused")},pointerfocusout:function(a){a.stopPropagation(),$(a.currentTarget).removeClass("is-focused")},onRemove:function(){this.unbindDocumentEvents(),this.removeWidgets(),this===this.constructor.instance&&(this.constructor.instance=null)},removeWidgets:function(){var a=this.widgets;for(var b in a)a[b].remove();this.widgets={}},onGroupLabelClick:function(a){a.preventDefault(),this.options.multiOpenGroups||this.closeGroups();var b=$(a.target).closest(".group");this.toggleGroup(b)},toggleGroup:function(b){var c=a.util.isString(b)?this.$('.group[data-name="'+b+'"]'):$(b);c.hasClass("closed")?this.openGroup(c):this.closeGroup(c)},closeGroup:function(b,c){c=c||{};var d=a.util.isString(b)?this.$('.group[data-name="'+b+'"]'):$(b);!c.init&&d.hasClass("closed")||(d.addClass("closed"),this.trigger("group:close",d.data("name"),c))},openGroup:function(b,c){c=c||{};var d=a.util.isString(b)?this.$('.group[data-name="'+b+'"]'):$(b);(c.init||d.hasClass("closed"))&&(d.removeClass("closed"),this.trigger("group:open",d.data("name"),c))},closeGroups:function(){for(var a=0,b=this.$groups.length;a<b;a++)this.closeGroup(this.$groups[a])},openGroups:function(){for(var a=0,b=this.$groups.length;a<b;a++)this.openGroup(this.$groups[a])},COMPOSITE_OPERATORS:["not","and","or","nor"],PRIMITIVE_OPERATORS:["eq","ne","regex","text","lt","lte","gt","gte","in","nin","equal"],_isComposite:function(a){return b.intersection(this.COMPOSITE_OPERATORS,Object.keys(a)).length>0},_isPrimitive:function(a){var c=Object.keys(this.options.operators).concat(this.PRIMITIVE_OPERATORS);return b.intersection(c,Object.keys(a)).length>0},_evalCustomPrimitive:function(a,b,c){return!!this.options.operators[a].apply(this,[this.getModel(),b].concat(c))},_evalPrimitive:function(b){return Object.keys(b).reduce(function(c,d){var e=b[d];return Object.keys(e).reduce(function(b,c){var f=e[c],g=this.getCellAttributeValue(c);if(a.util.isFunction(this.options.operators[d]))return this._evalCustomPrimitive(d,g,f);switch(d){case"eq":return f==g;case"ne":return f!=g;case"regex":return new RegExp(f).test(g);case"text":return!f||a.util.isString(g)&&g.toLowerCase().indexOf(f)>-1;case"lt":return g<f;case"lte":return g<=f;case"gt":return g>f;case"gte":return g>=f;case"in":return Array.isArray(f)&&f.includes(g);case"nin":return Array.isArray(f)&&!f.includes(g);case"equal":return a.util.isEqual(f,g);default:return b}}.bind(this),!1)}.bind(this),!1)},_evalExpression:function(a){return this._isPrimitive(a)?this._evalPrimitive(a):Object.keys(a).reduce(function(c,d){var e=a[d];if("not"==d)return!this._evalExpression(e);var f=b.toArray(e).map(this._evalExpression,this);switch(d){case"and":return f.every(function(a){return!!a});case"or":return f.some(function(a){return!!a});case"nor":return!f.some(function(a){return!!a});default:return c}}.bind(this),!1)},_extractVariables:function(a){return Array.isArray(a)||this._isComposite(a)?b.toArray(a).reduce(function(a,b){return a.concat(this._extractVariables(b))}.bind(this),[]):b.toArray(a).reduce(function(a,b){return Object.keys(b)},[])},isExpressionValid:function(b){return b=a.util.omit(b,"otherwise","dependencies"),this._evalExpression(b)},extractExpressionPaths:function(a){var c=a&&a.dependencies||[];return a=b.omit(a,"otherwise","dependencies"),b.uniq(this._extractVariables(a).concat(c))},getGroupsStateKey:function(){if(a.util.isFunction(this.options.stateKey))return this.options.stateKey(this.getModel());throw new Error("Inspector: Option stateKey must be a function")},storeGroupsState:function(){var c=this.getGroupsStateKey(),d=b.toArray(this.$(".group.closed"));a.ui.Inspector.groupStates[c]=d.map(function(a){return $(a).attr("data-name")})},getGroupsState:function(){return a.ui.Inspector.groupStates[this.getGroupsStateKey()]},restoreGroupsState:function(){var b=function(b,c){a.util.forIn(c.options.groups,function(a,c){b(a,c)?this.closeGroup(c):this.openGroup(c)}.bind(c))},c=this.getGroupsStateKey();a.ui.Inspector.groupStates[c]?b(function(b,d){return a.ui.Inspector.groupStates[c].includes(d)},this):b(function(a){return a.closed},this)}},{groupStates:{},instance:null,create:function(b,c){c=c||{},a.util.defaults(c,{restoreGroupsState:!0,storeGroupsState:!0});var d=c.cell||c.cellView.model,e=this.instance;return e&&e.getModel()===d||(e&&e.el.parentNode&&(c.storeGroupsState&&e.storeGroupsState(),e.updateCell(),e.remove()),e=new this(c).render(),this.instance=e,$(b).html(e.el),c.restoreGroupsState&&e.restoreGroupsState()),e},close:function(){var a=this.instance;a&&a.remove()}})}(joint,joint.util);