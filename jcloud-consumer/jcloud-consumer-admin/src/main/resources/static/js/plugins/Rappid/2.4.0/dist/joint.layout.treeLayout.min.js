/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-07-01 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b,c){function d(b,c,d){d=a.util.defaults(d||{},{siblingGap:0}),this.width=0,this.height=0,this.layoutAreas=this.sortLayoutAreas(b),this.parentArea=c,this.siblingGap=d.siblingGap,this.exists()&&this.computeSize(d)}function e(b,c){this.root=b;var d=a.util.assign({},c,this.getRootAttributes(b,c.attributeNames)),e=c.gap||0;a.util.defaults(d,{parentGap:e,siblingGap:e,firstChildGap:e}),this.siblingRank=d.siblingRank,this.rootOffset=d.rootOffset,this.rootMargin=d.rootMargin,this.siblingGap=d.siblingGap,this.gap=this.parentGap=d.parentGap,this.nextSiblingGap=d.nextSiblingGap,this.prevSiblingGap=d.prevSiblingGap,this.firstChildGap=d.firstChildGap,this.dx=0,this.dy=0,this.width=0,this.height=0}a.util.assign(d.prototype,{sortLayoutAreas:function(b){var c=a.util.sortBy(b,"siblingRank");return c.forEach(function(a,b){a.siblingRank=b}),c},move:function(a,b){for(var c=0,d=this.layoutAreas.length;c<d;c++)this.layoutAreas[c].dx+=a,this.layoutAreas[c].dy+=b},exists:function(){return this.layoutAreas.length>0},sumGaps:function(a){var b=Math.max(this.layoutAreas.length-1,0);return b*a},getSiblingRankByPoint:function(a){if(!this.exists())return-1;var b=this.findAreaByPoint(a);return b?b.siblingRank-1:this.layoutAreas.length-1},getFirstChildConnectionPoints:function(){return[]},getConnectionPoints:function(a,b){if(!this.exists())return this.getFirstChildConnectionPoints(a);var c={dx:a.x-this.parentArea.rootCX,dy:a.y-this.parentArea.rootCY};return this.layoutAreas[0].getRootVertices(c,b)},getParentConnectionPoint:function(){var a=this.parentArea,b=this.proxyLayoutArea("getConnectionPoint",a.rootSize),d=c.point(a.rootCX,a.rootCY);return d.offset(b.x,b.y)},getChildConnectionPoint:function(a,b){var d=this.proxyLayoutArea("getConnectionPoint",b);return c.point(a).difference(d)},proxyLayoutArea:function(a){var b=Array.prototype.slice.call(arguments,1);return e.fromDirection(this.direction).prototype[a].apply(this.parentArea,b)}}),d.extend=b.Model.extend;var f=d.extend({getTopDY:function(){return-this.height/2},findAreaByPoint:function(a){return this.layoutAreas.find(function(b){return b.rootCY>a.y})},computeSize:function(a){this.height=this.sumGaps(a.siblingGap);var b=this.layoutAreas;this.height+=b.reduce(function(a,b){return a+b.height+b.prevSiblingGap+b.nextSiblingGap},0),b.reduce(function(b,c){return this.width=Math.max(this.width,c.getExtendedWidth()),c.dy+=b+c.getCY(),b+c.prevSiblingGap+c.height+c.nextSiblingGap+a.siblingGap}.bind(this),this.getTopDY())},getYTowardsParent:function(){return this.parentArea.rootCY},getXTowardsParent:function(){var a=this.parentArea;return a.rootCX+this.LRSign*(a.rootSize.width/2+a.gap)},getNeighborPointFromRank:function(a){var b,c=this.siblingGap;if(this.exists()){var d=this.layoutAreas[a],e=this.layoutAreas[a+1];b=d?e?(d.y+d.height+e.y)/2:d.y+d.height+c/2:e.y-c/2}else b=this.getYTowardsParent();return{x:this.getXTowardsParent(),y:b}}}),g=f.extend({direction:"L",LRSign:-1}),h=f.extend({direction:"R",LRSign:1}),i={getXTowardsParent:function(){var a=this.parentArea;return a.rootCX+this.LRSign*a.gap},getYTowardsParent:function(){var a=this.parentArea,b=a.getLRHeight(a.siblings)/2;return b+=Math.min(a.firstChildGap,this.siblingGap/2),a.rootCY+this.TBSign*b},getFirstChildConnectionPoints:function(a){return[c.point(this.parentArea.rootCX,a.y)]},getChildConnectionPoint:function(a,b){return c.point(a).offset(-this.LRSign*b.width/2,0)},getParentConnectionPoint:function(){var a=this.parentArea,b=c.point(a.rootCX,a.rootCY);return b.offset(0,this.TBSign*a.rootSize.height/2)}},j={getTopDY:function(){return 0}},k={getTopDY:function(){return-this.height}},l=f.extend({direction:"BR",LRSign:1,TBSign:1});a.util.assign(l.prototype,i,j);var m=f.extend({direction:"BL",LRSign:-1,TBSign:1});a.util.assign(m.prototype,i,j);var n=f.extend({direction:"TR",LRSign:1,TBSign:-1});a.util.assign(n.prototype,i,k);var o=f.extend({direction:"TL",LRSign:-1,TBSign:-1});a.util.assign(o.prototype,i,k);var p=d.extend({getLeftDX:function(){return-this.width/2},findAreaByPoint:function(a){return this.layoutAreas.find(function(b){return b.rootCX>a.x})},computeSize:function(a){this.width=this.sumGaps(a.siblingGap);var b=this.layoutAreas;this.width+=b.reduce(function(a,b){return a+b.width+b.prevSiblingGap+b.nextSiblingGap},0),b.reduce(function(b,c){return this.height=Math.max(this.height,c.getExtendedHeight()),c.dx+=b+c.getCX(),b+c.prevSiblingGap+c.width+c.nextSiblingGap+a.siblingGap}.bind(this),this.getLeftDX())},getNeighborPointFromRank:function(a){var b;if(this.exists()){var c=this.layoutAreas[a],d=this.layoutAreas[a+1];b=c?d?(c.x+c.width+d.x)/2:c.x+c.width+this.siblingGap/2:d.x-this.siblingGap/2}else b=this.parentArea.rootCX;return{x:b,y:this.getYTowardsParent()}}}),q=p.extend({direction:"T",getYTowardsParent:function(){var a=this.parentArea;return a.rootCY-a.getLRHeight()/2-a.gap}}),r=p.extend({direction:"B",getYTowardsParent:function(){var a=this.parentArea;return a.rootCY+a.getLRHeight()/2+a.gap}});a.util.assign(e,{create:function(a,b,c){var d=e.fromDirection(a,c);return new d(b,c)},fromDirection:function(a,b){var c;switch(a){case"L":c=t;break;case"T":c=u;break;case"R":c=s;break;case"B":c=v;break;case"BR":c=w;break;case"BL":c=x;break;case"TR":c=y;break;case"TL":c=z;break;default:c=e}return c}}),a.util.assign(e.prototype,{direction:null,compute:function(a){this.childAreas=a,this.computeRelativePosition(this.root,a)},getHeight:function(a,b){return this.getTHeight(a)+this.getBHeight(a)+this.getLRHeight()},getWidth:function(a,b){var c=Math.max(a.T.width,a.B.width)/2,d=Math.max(this.getLWidth(a,b)+b.width/2,c),e=Math.max(this.getRWidth(a,b)+b.width/2,c);return d+e},getLRHeight:function(){return Math.max(this.rootSize.height,this.siblings.L.height,this.siblings.R.height)},getTHeight:function(a){return a.T.height+this.getTXHeight(a)},getBHeight:function(a){return a.B.height+this.getBXHeight(a)},getXLRWidth:function(a,b){return this.getLWidth(a,b)+b.width+this.getRWidth(a,b)},getXRWidth:function(a,b){var c=Math.max(a.BR.width,a.TR.width);return c>0&&(c-=b.width/2),c},getTXHeight:function(a){var b=Math.max(a.TR.height,a.TL.height);return b>0&&(b+=this.firstChildGap),b},getBXHeight:function(a){var b=Math.max(a.BR.height,a.BL.height);return b>0&&(b+=this.firstChildGap),b},getXLWidth:function(a,b){var c=Math.max(a.BL.width,a.TL.width);return c>0&&(c-=b.width/2),c},getRWidth:function(a,b){return Math.max(a.R.width,this.getXRWidth(a,b))},getLWidth:function(a,b){return Math.max(a.L.width,this.getXLWidth(a,b))},getTBOverlap:function(a,b){var c=Math.max(a.T.width,a.B.width);return c>0&&(c-=b.width,c/=2),c},getRootDX:function(a,b){var c=this.getTBOverlap(a,b),d=Math.max(this.getLWidth(a,b),c);return d-=Math.max(this.getRWidth(a,b),c),d/2},getMinimalGap:function(a){return Math.min(a.siblingGap,this.firstChildGap,this.parentGap)},getBBox:function(a){var b=c.rect(this),d=a&&a.expandBy;return d&&b.moveAndExpand({x:-d,y:-d,width:2*d,height:2*d}),b},containsPoint:function(a,b){return this.getBBox(b).containsPoint(a)},getLayoutSiblings:function(a){return this.siblings[a]},getExtendedWidth:function(){return this.width+this.gap+this.rootOffset},getExtendedHeight:function(){return this.height+this.gap+this.rootOffset},findMinimalAreaByPoint:function(a,b){if(!this.containsPoint(a,b))return null;var c;return this.childAreas.some(function(d){return c=d.findMinimalAreaByPoint(a,b),!!c}),c||this},getType:function(){return Object.keys(this.siblings).reduce(function(a,b){var c=this.siblings[b];return c.exists()?a.concat(b):a}.bind(this),[]).sort().join("-")},getRootAttributes:function(b,c){var d={rootOffset:b.get(c.offset||"offset")||0,rootMargin:b.get(c.margin||"margin")||0,prevSiblingGap:b.get(c.prevSiblingGap||"prevSiblingGap")||0,nextSiblingGap:b.get(c.nextSiblingGap||"nextSiblingGap")||0},e=b.get(c.siblingRank||"siblingRank");a.util.isNumber(e)&&(d.siblingRank=e);var f=b.get(c.firstChildGap||"firstChildGap");return a.util.isNumber(f)&&(d.firstChildGap=f),d},getRootSize:function(a,b){var c=a.size();return c[this.marginDimension]+=b,c},createSiblings:function(b,c){var d=a.util.groupBy(b,"direction");return{L:new g(d.L,this,c),T:new q(d.T,this,c),R:new h(d.R,this,c),B:new r(d.B,this,c),BR:new l(d.BR,this,c),BL:new m(d.BL,this,c),TR:new n(d.TR,this,c),TL:new o(d.TL,this,c)}},computeSize:function(a,b){return{width:this.getWidth(a,b),height:this.getHeight(a,b)}},computeOrigin:function(){var a=this.siblings,b=this.rootSize,c=Math.max(this.getLWidth(a,b)+b.width/2,this.getXLWidth(a,b)+b.width/2,a.T.width/2,a.B.width/2);return{x:this.rootCX-c,y:this.rootCY-this.getTHeight(a)-this.getLRHeight()/2}},moveSiblings:function(a,b){if(this.hasHorizontalSiblings(a)){var c=b.width/2;a.L.move(-c,0),a.R.move(c,0)}if(this.hasVerticalSiblings(a)){var d=this.getLRHeight()/2;a.T.move(0,-d),a.B.move(0,d),a.BR.move(0,d),a.BL.move(0,d),a.B.move(0,this.getBXHeight(a)),a.TR.move(0,-d),a.TL.move(0,-d),a.T.move(0,-this.getTXHeight(a))}},moveRootToConnectionPoint:function(a){var b=this.getConnectionPoint(a);this.dx+=b.x,this.dy+=b.y},computeRelativePosition:function(b,c){var d=this.siblings=this.createSiblings(c,{siblingGap:this.siblingGap}),e=this.rootSize=this.getRootSize(b,this.rootMargin);a.util.assign(this,this.computeSize(d,e)),this.moveSiblings(d,e),this.moveRootToConnectionPoint(e),this.moveRootBehindSiblings(d,e),this.moveRootFromParent()},computeAbsolutePosition:function(){if(this.parentArea)this.rootCX=this.parentArea.rootCX+this.dx,this.rootCY=this.parentArea.rootCY+this.dy,this.level=this.parentArea.level+1;else{var b=this.root.getBBox().center();this.rootCX=b.x,this.rootCY=b.y,this.level=0}a.util.assign(this,this.computeOrigin())},hasVerticalSiblings:function(a){return a.T.exists()||a.B.exists()||a.BR.exists()||a.BL.exists()||a.TR.exists()||a.TL.exists()},hasHorizontalSiblings:function(a){return a.L.exists()||a.R.exists()},isSourceArea:function(){return!this.parentArea},isSinkArea:function(){return 0===this.childAreas.length},getRootPosition:function(){var a=this.root.get("size");return{x:this.rootCX-a.width/2,y:this.rootCY-a.height/2}},getRootVertices:function(b,c){if(c=c||{},b=b||this,0===b[this.deltaCoordinate]||!this.parentArea)return[];var d,e=this.parentArea.getInnerSize();if(!c.ignoreSiblings&&this.hasSiblingsBetweenParent()){var f=this.siblings[this.oppositeDirection];d=this.getRelativeVerticesAvoidingSiblings(e,b,f)}else d=this.getRelativeVertices(e,b);return a.util.invoke(d,"offset",this.parentArea.rootCX,this.parentArea.rootCY)},getInnerSize:function(){return{width:this.rootSize.width,height:this.getLRHeight()}},getConnectionPoint:function(){return null},getRelativeVertices:function(){return null},moveRootFromParent:function(){},moveRootBehindSiblings:function(){},hasSiblingsBetweenParent:function(){return!this.isSourceArea()&&this.siblings[this.oppositeDirection].exists()},getCY:function(){return this.height/2+this.prevSiblingGap},getCX:function(){return this.width/2+this.prevSiblingGap}}),e.extend=b.Model.extend;var s=e.extend({direction:"R",oppositeDirection:"L",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(a){return c.point(a.width/2,0)},moveRootBehindSiblings:function(a,b){this.dx+=Math.max(this.getLWidth(a,b),this.getTBOverlap(a,b)),this.dy+=(this.getTHeight(a)-this.getBHeight(a))/2},moveRootFromParent:function(){this.dx+=this.parentGap+this.rootOffset},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a),d=this.parentGap/2;return[c.clone().offset(d,0),c.clone().offset(d,b.dy)]},getRelativeVerticesAvoidingSiblings:function(a,b,c){var d=this.getConnectionPoint(a),e=c.siblingGap/2,f=this.dx>0?-1:1,g=b.dy+f*(c.height+e)/2,h=b.dy+f*this.rootSize.height/4,i=this.gap/2,j=1.5*i+Math.max(this.getLWidth(this.siblings,this.rootSize),this.getTBOverlap(this.siblings,this.rootSize));return[d.clone().offset(i,0),d.clone().offset(i,g),d.clone().offset(j,g),d.clone().offset(j,h)]}}),t=e.extend({direction:"L",oppositeDirection:"R",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(a){return c.point(-a.width/2,0)},moveRootBehindSiblings:function(a,b){this.dx-=Math.max(this.getRWidth(a,b),this.getTBOverlap(a,b)),this.dy+=(this.getTHeight(a)-this.getBHeight(a))/2},moveRootFromParent:function(){this.dx-=this.parentGap+this.rootOffset},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a),d=-this.parentGap/2;return[c.clone().offset(d,0),c.clone().offset(d,b.dy)]},getRelativeVerticesAvoidingSiblings:function(a,b,c){var d=this.getConnectionPoint(a),e=this.dx>0?-1:1,f=b.dy+e*(c.height+c.siblingGap/2)/2,g=b.dy+e*this.rootSize.height/4,h=this.gap/2,i=1.5*h+Math.max(this.getRWidth(this.siblings,this.rootSize),this.getTBOverlap(this.siblings,this.rootSize));return[d.clone().offset(-h,0),d.clone().offset(-h,f),d.clone().offset(-i,f),d.clone().offset(-i,g)]}}),u=e.extend({direction:"T",oppositeDirection:"B",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(a){return c.point(0,-a.height/2)},moveRootBehindSiblings:function(a,b){this.dx+=this.getRootDX(a,b),this.hasHorizontalSiblings(a)&&(this.dy-=(this.getLRHeight()-b.height)/2),this.dy-=this.getBHeight(a)},moveRootFromParent:function(){this.dy-=this.parentGap+this.rootOffset},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a),d=-this.getTXHeight(this.parentArea.siblings)-this.parentGap/2;return[c.clone().offset(0,d),c.clone().offset(b.dx,d)]},getRelativeVerticesAvoidingSiblings:function(a,b){var c=this.getConnectionPoint(a),d=this.siblings,e=d.B,f=this.getTXHeight(this.parentArea.siblings)+this.parentGap/2,g=f+e.height;g+=this.getBXHeight(this.siblings)+this.parentGap/4;var h=this.dy<0?-1:1,i=d[h>0?"BR":"BL"].width,j=b.dx;j+=h*(Math.max(i,e.width/2)+e.siblingGap/4);var k=b.dx+h*this.rootSize.width/4;return[c.clone().offset(0,-f),c.clone().offset(j,-f),c.clone().offset(j,-g),c.clone().offset(k,-g)]}}),v=e.extend({direction:"B",oppositeDirection:"T",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(a){return c.point(0,a.height/2)},moveRootBehindSiblings:function(a,b){this.dx+=this.getRootDX(a,b),this.dy+=this.getTHeight(a),this.hasHorizontalSiblings(a)&&(this.dy+=(this.getLRHeight()-b.height)/2)},moveRootFromParent:function(){this.dy+=this.parentGap+this.rootOffset},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a),d=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2;return[c.clone().offset(0,d),c.clone().offset(b.dx,d)]},getRelativeVerticesAvoidingSiblings:function(a,b){var c=this.getConnectionPoint(a),d=this.siblings,e=d.T,f=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2,g=f+e.height;g+=this.getTXHeight(d)+this.parentGap/4;var h=this.dy<0?-1:1,i=d[h>0?"TR":"TL"].width,j=b.dx;j+=h*(Math.max(i,e.width/2)+e.siblingGap/4);var k=b.dx+h*this.rootSize.width/4;return[c.clone().offset(0,f),c.clone().offset(j,f),c.clone().offset(j,g),c.clone().offset(k,g)]}}),w=e.extend({direction:"BR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(a){return c.point(0,a.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(a,b){var c=Math.max(a.T.width,a.B.width);this.dx+=Math.max(this.getLWidth(a,b),(c-b.width)/2),this.dy+=this.getTHeight(a),this.hasHorizontalSiblings(a)&&(this.dy+=(this.getLRHeight()-b.height)/2)},moveRootFromParent:function(){var a=this.parentArea;a&&(this.dy+=a.firstChildGap),this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a);return[c.clone().offset(0,b.dy-a.height/2)]},getRelativeVerticesAvoidingSiblings:function(a,b,d){var e=b.dx-this.rootSize.width/4,f=b.dy;return f+=Math.max(d.height,this.rootSize.height)/2,f+=this.getMinimalGap(d)/2,[c.point(0,f),c.point(e,f)]}}),x=e.extend({direction:"BL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(a){return c.point(0,a.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(a,b){var c=Math.max(a.T.width,a.B.width);this.dx-=Math.max(this.getRWidth(a,b),(c-b.width)/2),this.dy+=this.getTHeight(a),this.hasHorizontalSiblings(a)&&(this.dy+=(this.getLRHeight()-b.height)/2)},moveRootFromParent:function(){var a=this.parentArea;a&&(this.dy+=a.firstChildGap),this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a);return[c.clone().offset(0,b.dy-a.height/2)]},getRelativeVerticesAvoidingSiblings:function(a,b,d){var e=b.dx+this.rootSize.width/4,f=b.dy;return f+=Math.max(d.height,this.rootSize.height)/2,f+=this.getMinimalGap(d)/2,[c.point(0,f),c.point(e,f)]}}),y=e.extend({direction:"TR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(a){return c.point(0,a.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(a,b){this.dx+=Math.max(this.getLWidth(a,b),this.getTBOverlap(a,b)),this.dy-=this.getBHeight(a),this.hasHorizontalSiblings(a)&&(this.dy-=(this.getLRHeight()-b.height)/2)},moveRootFromParent:function(){var a=this.parentArea;a&&(this.dy-=a.firstChildGap),this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a);return[c.clone().offset(0,b.dy-a.height/2)]},getRelativeVerticesAvoidingSiblings:function(a,b,d){var e=b.dx-this.rootSize.width/4,f=b.dy;return f-=Math.max(d.height,this.rootSize.height)/2,f-=this.getMinimalGap(d)/2,[c.point(0,f),c.point(e,f)]}}),z=e.extend({direction:"TL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(a){return c.point(0,a.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(a,b){this.dx-=Math.max(this.getRWidth(a,b),this.getTBOverlap(a,b)),this.dy-=this.getBHeight(a),this.hasHorizontalSiblings(a)&&(this.dy-=(this.getLRHeight()-b.height)/2)},moveRootFromParent:function(){var a=this.parentArea;a&&(this.dy-=a.firstChildGap),this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(a,b){var c=this.getConnectionPoint(a);return[c.clone().offset(0,b.dy-a.height/2)]},getRelativeVerticesAvoidingSiblings:function(a,b,d){var e=b.dx+this.rootSize.width/4,f=b.dy;return f-=Math.max(d.height,this.rootSize.height)/2,f-=this.getMinimalGap(d)/2,[c.point(0,f),c.point(e,f)]}}),A={rotate:function(a){var b="LRBT",c=b.indexOf(a[0])-b.indexOf(a[1]);return function(a){var d=b.indexOf(a);return d>=0?b[(4+d-c)%4]:a}},flip:function(a){var b=a[0],c=a[1];return function(a){return a===b?c:a===c?b:a}},straighten:function(a){return function(){return a[1]}}},B=b.Model.extend({defaults:{graph:void 0,gap:20,parentGap:20,siblingGap:20,firstChildGap:20,direction:"R",directionRule:A.straighten,updatePosition:function(a,b,c){a.set("position",b,c)},updateVertices:function(a,b,c){a.set("vertices",b,c)},updateAttributes:null,filter:null,attributeNames:{}},initialize:function(){this._cacheOptions(this.attributes),this.layoutAreas={}},layout:function(a){this.layoutAreas={};for(var b=this.getGraphSources(a),c=0,d=b.length;c<d;c++)this.layoutTree(b[c],a);return this.trigger("layout:done",a),this},layoutTree:function(a,b){b=b||{},b.treeLayout=!0;var c=this._computeLayoutAreas(a,null,b);return this._computeAbsolutePositions(c),this._updateCells(c,b),this},getLayoutArea:function(a){return this.layoutAreas[a.id||a]||null},getRootLayoutAreas:function(){return this.getGraphSources().map(this.getLayoutArea,this)},getGraphSources:function(a){var b=this.graph.getSources();return this.filter&&b.length>0&&(b=this.filter(b,null,a)||b),b},getMinimalRootAreaByPoint:function(b){var c=this.getRootLayoutAreas().filter(function(a){return a.containsPoint(b)});return a.util.isEmpty(c)?null:c.reduce(function(a,b){return b.width*b.height<a.min&&(a.min=b.width*b.height,a.item=b),a},{min:1/0,item:void 0}).item},_computeLayoutAreas:function(a,b,c){var d=b?b.direction:this.get("direction"),f=a.get(this.getAttributeName("direction"))||d,g=e.create(f,a,this.attributes);g.parentArea=b,g.link=this.graph.getConnectedLinks(a,{inbound:!0})[0];var h=this._getChildren(a,c);this.layoutAreas[a.id]=g;for(var i=[],j=0,k=h.length;j<k;j++)i.push(this._computeLayoutAreas(h[j],g,c));return g.compute(i),g},_cacheOptions:function(b){var c=["updateAttributes","updateVertices","updatePosition","filter"];c.forEach(function(c){this[c]=a.util.isFunction(b[c])?b[c]:null},this),this.graph=b.graph},_getChildren:function(a,b){if(this.layoutAreas[a.id])return[];var c=this.graph.getNeighbors(a,{outbound:!0});return this.filter&&c.length>0&&(c=this.filter(c,a,b)||c),c},_computeAbsolutePositions:function(a){a.computeAbsolutePosition(a);for(var b=0,c=a.childAreas.length;b<c;b++)this._computeAbsolutePositions(a.childAreas[b])},_updateCells:function(a,b){var c=a.root,d=a.link||null;d&&(this.updatePosition&&this.updatePosition(c,a.getRootPosition(),b),this.updateVertices&&this.updateVertices(d,a.getRootVertices(),b)),this.changeSiblingRank(c,a.siblingRank,b),this.updateAttributes&&this.updateAttributes(a,c,d,b);for(var e=0,f=a.childAreas.length;e<f;e++)this._updateCells(a.childAreas[e],b)},updateDirections:function(a,b,c){c=c||{};var d=this.getAttributeName("direction"),e=this.get("directionRule")(b);this.graph.search(a,function(a,b){if(0!==b){var f=e(a.get(d));this.changeDirection(a,f,c)}}.bind(this),{outbound:!0})},reconnectElement:function(a,b,c){c=c||{};var d=this.getLayoutArea(a),e=d.link;if(e){e.set("source",{id:b.id||b},c);var f=d.direction,g=c.direction||f,h=c.siblingRank||void 0;return this.changeSiblingRank(a,h,c),this.changeDirection(a,g,c),f!==g&&this.updateDirections(a,[f,c.direction],c),!0}return!1},changeSiblingRank:function(a,b,c){a.set(this.getAttributeName("siblingRank"),b,c)},changeDirection:function(a,b,c){a.set(this.getAttributeName("direction"),b,c)},getAttributeName:function(a){return this.get("attributeNames")[a]||a},getAttribute:function(a,b){return a.get(this.getAttributeName(b))},prepare:function(){return this}},{directionRules:A});a.layout.TreeLayout=B}(joint,Backbone,g);